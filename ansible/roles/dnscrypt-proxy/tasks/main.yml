---
- import_tasks: deinstall.yml

- name: install dnscrypt-proxy
  become: yes
  pkgng: name=dnscrypt-proxy2 state=present

- name: configure dnscrypt-proxy
  become: yes
  copy:
    src: dnscrypt-proxy.toml
    dest: /usr/local/etc/dnscrypt-proxy.toml
  notify:
    - restart dnscrypt-proxy

- name: ensure dnscrypt-proxy service directory
  become: yes
  file:
    path: "{{item}}"
    state: directory
  with_items:
    - /var/service/dnscrypt-proxy
    - /var/service/dnscrypt-proxy/log

- name: install dnscrypt-proxy service
  become: yes
  copy:
    src: run
    dest: /var/service/dnscrypt-proxy/run
    mode: 0555
  notify:
    - rescan s6

- name: install dnscrypt-proxy logging service
  become: yes
  copy:
    src: log
    dest: /var/service/dnscrypt-proxy/log/run
    mode: 0555
  notify:
    - rescan s6
